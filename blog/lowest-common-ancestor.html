<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="57x57" href="/isotype.png"/><link rel="apple-touch-icon" sizes="60x60" href="/isotype.png"/><link rel="apple-touch-icon" sizes="72x72" href="/isotype.png"/><link rel="apple-touch-icon" sizes="76x76" href="/isotype.png"/><link rel="apple-touch-icon" sizes="114x114" href="/isotype.png"/><link rel="apple-touch-icon" sizes="120x120" href="/isotype.png"/><link rel="apple-touch-icon" sizes="144x144" href="/isotype.png"/><link rel="apple-touch-icon" sizes="152x152" href="/isotype.png"/><link rel="apple-touch-icon" sizes="180x180" href="/isotype.png"/><link rel="icon" type="image/png" sizes="192x192" href="/isotype.png"/><link rel="icon" type="image/png" sizes="32x32" href="/isotype.png"/><link rel="icon" type="image/png" sizes="96x96" href="/isotype.png"/><link rel="icon" type="image/png" sizes="16x16" href="/isotype.png"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="msapplication-TileImage" content="/isotype.png"/><meta name="theme-color" content="#ffffff"/><title>Lowest Common Ancestor</title><link rel="preload" href="/new-profile/_next/static/css/8e1df1737e67450786cc.css" as="style"/><link rel="stylesheet" href="/new-profile/_next/static/css/8e1df1737e67450786cc.css" data-n-g=""/><link rel="preload" href="/new-profile/_next/static/css/bc9bbcd6fea02b72560a.css" as="style"/><link rel="stylesheet" href="/new-profile/_next/static/css/bc9bbcd6fea02b72560a.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/new-profile/_next/static/chunks/main-5ab6ea82c9087f336e12.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/webpack-38f4ef47162466e52626.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/framework.7008427c9ed7ea1ea070.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/1ca0266d.bc7564fa166f0d34b14f.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/commons.c903b9c5c3d275f65bfc.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/74dccfed65656dfb6adb258ae839e136f67e0276.47b8922ced02d1ddaa2f.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/2412aec2c30a40454afb28aa7ad51596c664a3e6.1e80e1ab8448746fa0db.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/pages/_app-52d859afcfe46e563952.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/57c9d6e4b97e6bcf244aee8ce3648d5d9adaacb1.bfcec4d669b9affd02e0.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/798fd9b41a459e61ee4594ce38d25c96f259064c.8c8bea5984a65dd9a41b.js" as="script"/><link rel="preload" href="/new-profile/_next/static/chunks/pages/blog/lowest-common-ancestor-7a71ba803a87dfa33e45.js" as="script"/></head><body><div id="__next"><div class="flex flex-col min-h-screen font-sans text-base antialiased text-gray-800"><header class="px-6"><div class="pt-4 mx-auto max-w-7xl md:pt-6 xl:pt-8"><div class="flex justify-between pb-4 md:pb-0 md:border-b md:border-gray-200 md:justify-start"><a class="text-sm font-light tracking-wide uppercase md:text-base lg:text-xl" href="/"><span class="font-bold">Frank</span>Cary</a><button class="p-2 -m-2 text-gray-700 focus:outline-none md:hidden"><svg fill="currentColor" viewBox="0 0 20 20" class="block w-4 h-4"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path></svg></button><div class="items-center hidden ml-auto md:flex"><a class="pb-4 ml-6 -mb-px text-gray-600 border-b border-transparent xl:pb-6 lg:ml-8 lg:text-base xl:text-lg hover:text-gray-900" href="/projects">Projects</a><a class="pb-4 ml-6 -mb-px text-gray-600 border-b border-transparent xl:pb-6 lg:ml-8 lg:text-base xl:text-lg hover:text-gray-900" href="/podcast">Podcast</a><a class="pb-4 ml-6 -mb-px text-gray-600 border-b border-transparent xl:pb-6 lg:ml-8 lg:text-base xl:text-lg hover:text-gray-900" href="/contact">Contact</a></div></div><div class="md:hidden"></div></div></header><main class="flex flex-col flex-1"><div class="px-6 pt-6 md:pt-12 lg:pt-16 md:leading-relaxed md:text-lg- lg:text-lg"><div class="max-w-measure mx-auto"><article><div class="mb-8 md:mb-10"><h1 class="mt-8 text-3xl font-semibold leading-tight md:text-4xl lg:text-4-5xl">Lowest Common Ancestor</h1></div><p class="mt-4 lg:mt-6">One of the biggest challenges when writing a JavaScript application is keeping multiple parts of the interface in sync. A user interaction in one part of the interface often affects data in another. If not managed well, this data can end up in multiple places, but with inconsistent values.</p><img class="mt-4 lg:mt-6" src="/_next/static/media/1-gmail.1f72a1afa59432ff350ef41fab4cc5cb.gif"/><p class="mt-4 lg:mt-6"><em>Email 1 being unread is a piece of application state that affects multiple parts of the interface. After the email is read, the title should no longer be bold, and and Inbox unread count should decrease by one.</em></p><p class="mt-4 lg:mt-6">In the past few years, the JavaScript community has learned a lot about how to deal with this problem. The solution involves the principle of the <strong>Lowest Common Ancestor</strong>. To explain this principle, let&#x27;s look at some interface elements you might build while working on a real-world application.</p><p class="mt-4 lg:mt-6">The examples use Ember, but the principles are high level and apply to any technology used for building long-lived JavaScript applications.</p><h2 id="a-collapsible-panel-(a-single-view-of-app-state)" class="pt-20 mt-8 text-lg font-semibold leading-tight text-gray-900 border-t border-gray-200 md:text-2xl">A collapsible panel (a single view of app state)</h2><p class="mt-4 lg:mt-6">Let&#x27;s say we&#x27;re building an app with a collapsible panel:</p><img class="mt-4 lg:mt-6" src="/_next/static/media/2-panel.212ca3ec79877beb94bfa0544ba4dd5d.gif"/><p class="mt-4 lg:mt-6"><em>A collapsible panel, an element that opens and closes when the user clicks on it.</em></p><p class="mt-4 lg:mt-6">Here&#x27;s the component&#x27;s template:</p><div><div class="my-8 -mx-6 overflow-hidden sm:rounded-lg md:mx-auto"><pre class="language-handlebars subpixel-antialiased leading-relaxed text-sm- md:text-sm px-6 py-4 overflow-auto scrolling-touch" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#282c34"><code class="language-handlebars" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token token" style="color:#A9B2C0">&lt;</span><span class="token token" style="color:#F16372">a</span><span class="token" style="color:#F16372"> </span><span class="token token token handlebars language-handlebars token delimiter" style="color:#A9B2C0">{{</span><span class="token token token handlebars language-handlebars token" style="color:#F16372">action</span><span class="token token token handlebars language-handlebars" style="color:#8CC570"> </span><span class="token token token handlebars language-handlebars token" style="color:#8CC570">&#x27;toggleIsOpen&#x27;</span><span class="token token token handlebars language-handlebars token delimiter" style="color:#A9B2C0">}}</span><span class="token token" style="color:#A9B2C0">&gt;</span><span>
</span></span><span>  Panel Title
</span><span><span></span><span class="token token token" style="color:#A9B2C0">&lt;/</span><span class="token token" style="color:#F16372">a</span><span class="token token" style="color:#A9B2C0">&gt;</span><span>
</span></span><span>
</span><span><span></span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">{{</span><span class="token handlebars language-handlebars token" style="display:inline;color:#D373E3">#if</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars token" style="color:#F16372">isOpen</span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">}}</span><span>
</span></span><span><span>  </span><span class="token token token" style="color:#A9B2C0">&lt;</span><span class="token token" style="color:#F16372">div</span><span class="token token" style="color:#A9B2C0">&gt;</span><span>Anim pariatur cliche...</span><span class="token token token" style="color:#A9B2C0">&lt;/</span><span class="token token" style="color:#F16372">div</span><span class="token token" style="color:#A9B2C0">&gt;</span><span>
</span></span><span><span></span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">{{</span><span class="token handlebars language-handlebars token" style="display:inline;color:#D373E3">/if</span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">}}</span></span></code></pre></div></div><p class="mt-4 lg:mt-6">If the panel <code class="px-1 py-px text-sm bg-gray-100">isOpen</code>, we&#x27;ll show the body. Clicking the title triggers the <code class="px-1 py-px text-sm bg-gray-100">toggleIsOpen</code> action.</p><p class="mt-4 lg:mt-6">Here&#x27;s the component&#x27;s JavaScript:</p><div><div class="my-8 -mx-6 overflow-hidden sm:rounded-lg md:mx-auto"><pre class="language-js subpixel-antialiased leading-relaxed text-sm- md:text-sm px-6 py-4 overflow-auto scrolling-touch" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#282c34"><code class="language-js" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token module" style="color:#D373E3">export</span><span> </span><span class="token module" style="color:#D373E3">default</span><span> </span><span class="token" style="color:#F16372">Ember</span><span class="token" style="color:#A9B2C0">.</span><span class="token token" style="color:#F16372">Component</span><span class="token" style="color:#A9B2C0">.</span><span class="token method" style="color:#40B1F5">extend</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#A9B2C0">{</span><span>
</span></span><span><span>  isOpen</span><span class="token" style="color:#19B9C4">:</span><span> </span><span class="token" style="color:#DB975C">true</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span>
</span><span><span>  actions</span><span class="token" style="color:#19B9C4">:</span><span> </span><span class="token" style="color:#A9B2C0">{</span><span>
</span></span><span><span>    </span><span class="token" style="color:#40B1F5">toggleIsOpen</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#A9B2C0">)</span><span> </span><span class="token" style="color:#A9B2C0">{</span><span>
</span></span><span><span>      </span><span class="token" style="color:#D373E3">this</span><span class="token" style="color:#A9B2C0">.</span><span class="token method" style="color:#40B1F5">toggleProperty</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#8CC570">&quot;isOpen&quot;</span><span class="token" style="color:#A9B2C0">)</span><span class="token" style="color:#A9B2C0">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#A9B2C0">}</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span><span>  </span><span class="token" style="color:#A9B2C0">}</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span><span></span><span class="token" style="color:#A9B2C0">}</span><span class="token" style="color:#A9B2C0">)</span><span class="token" style="color:#A9B2C0">;</span></span></code></pre></div></div><p class="mt-4 lg:mt-6">The default value of <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> is <code class="px-1 py-px text-sm bg-gray-100">true</code>, so the panel starts out open. Whenever a user clicks the title, <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> toggles between <code class="px-1 py-px text-sm bg-gray-100">true</code> and <code class="px-1 py-px text-sm bg-gray-100">false</code>.</p><hr class="mt-4 border-gray-200 lg:mt-6"/><p class="mt-4 lg:mt-6">Currently, our application looks like this:</p><img class="mt-4 lg:mt-6" src="/_next/static/media/3-panel.d4d1fc73950a590636ed1354d87f673b.jpg"/><p class="mt-4 lg:mt-6"><code class="px-1 py-px text-sm bg-gray-100">isOpen</code> is the only piece of state in our application that changes. Further, the collapsible panel is the only part of the interface that needs to know about it. Because of this, it makes sense for the panel itself to &quot;own&quot; this piece of application state. So, we&#x27;ll leave <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> right where it is - as a simple property on the component.</p><h2 id="adding-a-button-(multiple-views-of-app-state)" class="pt-20 mt-8 text-lg font-semibold leading-tight text-gray-900 border-t border-gray-200 md:text-2xl">Adding a button (multiple views of app state)</h2><p class="mt-4 lg:mt-6">We have a new feature request: adding a separate button which can also toggle the panel. The button should also say &quot;Expand&quot; or &quot;Collapse&quot;, depending on the state of the panel.</p><img class="mt-4 lg:mt-6" src="/_next/static/media/4-panel.a585e20579e55c4bd196e24028ffc483.gif"/><p class="mt-4 lg:mt-6"><em>A collapsible panel and a button, which both depend on the same state.</em></p><p class="mt-4 lg:mt-6">We now have two elements in our application whose view depends on the same piece of state. What should we do?</p><p class="mt-4 lg:mt-6">One option is to add an <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> property to our <code class="px-1 py-px text-sm bg-gray-100">&lt;button&gt;</code> component, and try to keep both properties in sync:</p><img class="mt-4 lg:mt-6" src="/_next/static/media/5-panel.973228bad5e39ed5ef2ae6a189367c81.png"/><p class="mt-4 lg:mt-6">But, duplicating state like this is not a good solution, because it can easily lead to an inconsistent interface.</p><p class="mt-4 lg:mt-6">A better solution is to move the state up a level to <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code>, and have <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code> pass down <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> to both <code class="px-1 py-px text-sm bg-gray-100">&lt;collapsible-panel&gt;</code> and <code class="px-1 py-px text-sm bg-gray-100">&lt;button&gt;</code>:</p><img class="mt-4 lg:mt-6" src="/_next/static/media/6-panel.aa216a8bd74347fdf214b23ad874ce03.png"/><p class="mt-4 lg:mt-6">Think of the <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> properties on the two children as read-only pointers to the <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> property on <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code>. Now, both <code class="px-1 py-px text-sm bg-gray-100">&lt;collapsible-panel&gt;</code> and <code class="px-1 py-px text-sm bg-gray-100">&lt;button&gt;</code> are guaranteed to stay in sync, since they&#x27;re rendered from the same state.</p><p class="mt-4 lg:mt-6">Here&#x27;s the template for <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code>:</p><div><div class="my-8 -mx-6 overflow-hidden sm:rounded-lg md:mx-auto"><pre class="language-handlebars subpixel-antialiased leading-relaxed text-sm- md:text-sm px-6 py-4 overflow-auto scrolling-touch" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#282c34"><code class="language-handlebars" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">{{</span><span class="token handlebars language-handlebars token" style="color:#F16372">collapsible-panel</span><span class="token handlebars language-handlebars">
</span></span><span><span class="token handlebars language-handlebars">  </span><span class="token handlebars language-handlebars token" style="color:#F16372">isOpen</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">=</span><span class="token handlebars language-handlebars token" style="color:#F16372">isOpen</span><span class="token handlebars language-handlebars">
</span></span><span><span class="token handlebars language-handlebars">  </span><span class="token handlebars language-handlebars token" style="color:#F16372">onClick</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">=</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">(</span><span class="token handlebars language-handlebars token" style="color:#F16372">action</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars token" style="color:#8CC570">&#x27;toggleIsOpen&#x27;</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">)</span><span class="token handlebars language-handlebars">
</span></span><span><span class="token handlebars language-handlebars"></span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">}}</span><span>
</span></span><span>
</span><span><span></span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">{{</span><span class="token handlebars language-handlebars token" style="color:#F16372">button</span><span class="token handlebars language-handlebars">
</span></span><span><span class="token handlebars language-handlebars">  </span><span class="token handlebars language-handlebars token" style="color:#F16372">isOpen</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">=</span><span class="token handlebars language-handlebars token" style="color:#F16372">isOpen</span><span class="token handlebars language-handlebars">
</span></span><span><span class="token handlebars language-handlebars">  </span><span class="token handlebars language-handlebars token" style="color:#F16372">onClick</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">=</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">(</span><span class="token handlebars language-handlebars token" style="color:#F16372">action</span><span class="token handlebars language-handlebars"> </span><span class="token handlebars language-handlebars token" style="color:#8CC570">&#x27;toggleIsOpen&#x27;</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">)</span><span class="token handlebars language-handlebars">
</span></span><span><span class="token handlebars language-handlebars"></span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">}}</span></span></code></pre></div></div><p class="mt-4 lg:mt-6">And here&#x27;s the JS, which looks exactly the same as <code class="px-1 py-px text-sm bg-gray-100">&lt;collapsible-panel&gt;</code> did in the first example:</p><div><div class="my-8 -mx-6 overflow-hidden sm:rounded-lg md:mx-auto"><pre class="language-js subpixel-antialiased leading-relaxed text-sm- md:text-sm px-6 py-4 overflow-auto scrolling-touch" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#282c34"><code class="language-js" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token module" style="color:#D373E3">export</span><span> </span><span class="token module" style="color:#D373E3">default</span><span> </span><span class="token" style="color:#F16372">Ember</span><span class="token" style="color:#A9B2C0">.</span><span class="token token" style="color:#F16372">Component</span><span class="token" style="color:#A9B2C0">.</span><span class="token method" style="color:#40B1F5">extend</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#A9B2C0">{</span><span>
</span></span><span><span>  isOpen</span><span class="token" style="color:#19B9C4">:</span><span> </span><span class="token" style="color:#DB975C">true</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span>
</span><span><span>  actions</span><span class="token" style="color:#19B9C4">:</span><span> </span><span class="token" style="color:#A9B2C0">{</span><span>
</span></span><span><span>    </span><span class="token" style="color:#40B1F5">toggleIsOpen</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#A9B2C0">)</span><span> </span><span class="token" style="color:#A9B2C0">{</span><span>
</span></span><span><span>      </span><span class="token" style="color:#D373E3">this</span><span class="token" style="color:#A9B2C0">.</span><span class="token method" style="color:#40B1F5">toggleProperty</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#8CC570">&quot;isOpen&quot;</span><span class="token" style="color:#A9B2C0">)</span><span class="token" style="color:#A9B2C0">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#A9B2C0">}</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span><span>  </span><span class="token" style="color:#A9B2C0">}</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span><span></span><span class="token" style="color:#A9B2C0">}</span><span class="token" style="color:#A9B2C0">)</span><span class="token" style="color:#A9B2C0">;</span></span></code></pre></div></div><p class="mt-4 lg:mt-6">When the user clicks either the <code class="px-1 py-px text-sm bg-gray-100">&lt;collapsible-panel&gt;</code> or the <code class="px-1 py-px text-sm bg-gray-100">&lt;button&gt;</code>, we&#x27;ll send an action up to <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code>, which will then change its <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> property. The new value of <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> propogates throughout the rest of the app, and the problem of inconsistent interface elements goes away.</p><p class="mt-4 lg:mt-6">Crucially, we&#x27;ve made sure that only the owner of the state - <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code>, in this case - is able to change that state. The children delegate their actions up to the owner.</p><hr class="mt-4 border-gray-200 lg:mt-6"/><p class="mt-4 lg:mt-6">By moving the state up to <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code> and giving <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> a single source of truth, we were able to ensure that <code class="px-1 py-px text-sm bg-gray-100">&lt;collapsible-panel&gt;</code> and <code class="px-1 py-px text-sm bg-gray-100">&lt;button&gt;</code> would never fall out of sync.</p><p class="mt-4 lg:mt-6">In the example above, <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code> was the <em>only</em> ancestor of both components in our component tree. Say we had a larger app:</p><img class="mt-4 lg:mt-6" src="/_next/static/media/7-panel.1afe167dd7e986b77e7f716c8a1b00d0.png"/><p class="mt-4 lg:mt-6">In this case, it would be sufficient to move <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> to <code class="px-1 py-px text-sm bg-gray-100">&lt;main&gt;</code> to ensure <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> had a single source of truth.</p><p class="mt-4 lg:mt-6">Now, a definition. Given a set of components, the <em>Lowest Common Ancestor</em> of this set is the component that&#x27;s deepest in the UI tree but still above each component in that set.</p><p class="mt-4 lg:mt-6">This definition along with the discussion above leads us to the following general principle:</p><blockquote class="pl-4 italic border-l-4 border-gray-200"><p class="mt-4 lg:mt-6"><em>When dealing with changing application state that lives in your UI hierarchy, store that state in the <strong>Lowest Common Ancestor</strong> of all components that need it.</em></p></blockquote><p class="mt-4 lg:mt-6">Storing shared state on the LCA, and then having that common ancestor pass its state to the relevant children, ensures that the state will have a single source of truth, and that every component that renders from that state will stay in sync.</p><p class="mt-4 lg:mt-6">Note that it can sometimes be convenient to create a new common ancestor component, just for the sake of owning and managing the shared state.</p><h2 id="adding-a-logout-button-(pulling-app-state-out-of-the-ui)" class="pt-20 mt-8 text-lg font-semibold leading-tight text-gray-900 border-t border-gray-200 md:text-2xl">Adding a logout button (pulling app state out of the UI)</h2><p class="mt-4 lg:mt-6">In many situations, the principle of LCA is sufficient. State has a single source of truth, and is passed down to all children who need it. The problem you can run into, however, is when the LCA is very far away in your component hierarchy from the relevant children.</p><p class="mt-4 lg:mt-6">In this case, you can end up with many components acting as middlemen. These components must know about and pass along various pieces of shared state to leaf components, making your UI difficult to refactor. There&#x27;s even a <a class="text-blue-500 underline" href="https://sourcemaking.com/refactoring/smells/middle-man">code smell of the same name</a> in object-oriented design, suggesting that this is indeed a concern.</p><p class="mt-4 lg:mt-6">An example of how this could happen is if many components in your app needed to know about the current user:</p><img class="mt-4 lg:mt-6" src="/_next/static/media/8-panel.854661c10c93eacffbc55135c6623c72.png"/><p class="mt-4 lg:mt-6"><em>In this app, many components need to know about the current user.</em></p><p class="mt-4 lg:mt-6">Assuming this many nodes need to know about the current user, the LCA would be <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code>, and every component would need to pass along <code class="px-1 py-px text-sm bg-gray-100">currentUser</code> to every other component. This definitely smells like Middle Man.</p><p class="mt-4 lg:mt-6">The solution to this problem is to <em>pull the state out of the UI hierarchy</em>. The idea here is that, while <code class="px-1 py-px text-sm bg-gray-100">isOpen</code> in our earlier example corresponded directly to a particular onscreen UI element (whether the panel was open), <code class="px-1 py-px text-sm bg-gray-100">currentUser</code> does not. So, it doesn&#x27;t really make sense for <code class="px-1 py-px text-sm bg-gray-100">&lt;app&gt;</code> (or any other UI element) to &quot;own&quot; <code class="px-1 py-px text-sm bg-gray-100">currentUser</code>.</p><p class="mt-4 lg:mt-6">In Ember, we can use a Service to solve this problem (in React, you might use a Flux store). A Service is a long-lived data container that exists independent of the UI tree. After we set it up, components can use <em>dependency injection</em> to ask for the data in the Service. Importantly, their parent components are none the wiser.</p><div><div class="my-8 -mx-6 overflow-hidden sm:rounded-lg md:mx-auto"><pre class="language-js subpixel-antialiased leading-relaxed text-sm- md:text-sm px-6 py-4 overflow-auto scrolling-touch" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#282c34"><code class="language-js" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token" style="color:#5A6371;font-style:italic">// app/services/current-user.js</span><span>
</span></span><span><span></span><span class="token module" style="color:#D373E3">export</span><span> </span><span class="token module" style="color:#D373E3">default</span><span> </span><span class="token" style="color:#F16372">Ember</span><span class="token" style="color:#A9B2C0">.</span><span class="token token" style="color:#F16372">Service</span><span class="token" style="color:#A9B2C0">.</span><span class="token method" style="color:#40B1F5">extend</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#A9B2C0">{</span><span>
</span></span><span><span>  name</span><span class="token" style="color:#19B9C4">:</span><span> </span><span class="token" style="color:#8CC570">&quot;Bob&quot;</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span><span>  email</span><span class="token" style="color:#19B9C4">:</span><span> </span><span class="token" style="color:#8CC570">&quot;bob@acme.com&quot;</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span><span></span><span class="token" style="color:#A9B2C0">}</span><span class="token" style="color:#A9B2C0">)</span><span class="token" style="color:#A9B2C0">;</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color:#5A6371;font-style:italic">// app/components/sidebar.js</span><span>
</span></span><span><span></span><span class="token module" style="color:#D373E3">export</span><span> </span><span class="token module" style="color:#D373E3">default</span><span> </span><span class="token" style="color:#F16372">Ember</span><span class="token" style="color:#A9B2C0">.</span><span class="token token" style="color:#F16372">Component</span><span class="token" style="color:#A9B2C0">.</span><span class="token method" style="color:#40B1F5">extend</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#A9B2C0">{</span><span>
</span></span><span><span>  currentUser</span><span class="token" style="color:#19B9C4">:</span><span> </span><span class="token" style="color:#F16372">Ember</span><span class="token" style="color:#A9B2C0">.</span><span class="token" style="color:#40B1F5">inject</span><span class="token" style="color:#A9B2C0">.</span><span class="token method" style="color:#40B1F5">service</span><span class="token" style="color:#A9B2C0">(</span><span class="token" style="color:#8CC570">&quot;current-user&quot;</span><span class="token" style="color:#A9B2C0">)</span><span class="token" style="color:#A9B2C0">,</span><span>
</span></span><span><span></span><span class="token" style="color:#A9B2C0">}</span><span class="token" style="color:#A9B2C0">)</span><span class="token" style="color:#A9B2C0">;</span></span></code></pre></div></div><p class="mt-4 lg:mt-6">Now, <code class="px-1 py-px text-sm bg-gray-100">&lt;sidebar&gt;</code> can access <code class="px-1 py-px text-sm bg-gray-100">currentUser</code> in its template:</p><div><div class="my-8 -mx-6 overflow-hidden sm:rounded-lg md:mx-auto"><pre class="language-handlebars subpixel-antialiased leading-relaxed text-sm- md:text-sm px-6 py-4 overflow-auto scrolling-touch" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;background:#282c34"><code class="language-handlebars" style="color:#A9B2C0;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token token" style="color:#A9B2C0">&lt;</span><span class="token token" style="color:#F16372">h2</span><span class="token token" style="color:#A9B2C0">&gt;</span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">{{</span><span class="token handlebars language-handlebars token" style="color:#F16372">currentUser</span><span class="token handlebars language-handlebars token" style="color:#A9B2C0">.</span><span class="token handlebars language-handlebars token" style="color:#F16372">name</span><span class="token handlebars language-handlebars token delimiter" style="color:#A9B2C0">}}</span><span class="token token token" style="color:#A9B2C0">&lt;/</span><span class="token token" style="color:#F16372">h2</span><span class="token token" style="color:#A9B2C0">&gt;</span></span></code></pre></div></div><p class="mt-4 lg:mt-6"><code class="px-1 py-px text-sm bg-gray-100">&lt;sidebar&gt;</code> has become more self-contained, making it easier to move around in the UI in later refactorings.</p><h2 id="conclusion" class="pt-20 mt-8 text-lg font-semibold leading-tight text-gray-900 border-t border-gray-200 md:text-2xl">Conclusion</h2><p class="mt-4 lg:mt-6">So, when should application state exist in the UI hierarchy, and when should it be pulled out? As in most areas of software design, there is no black and white answer. Instead, we must understand the tradeoffs involved, and make decisions on a case-by-case basis.</p><p class="mt-4 lg:mt-6">State that&#x27;s stored directly in the UI hierarchy is often easier to understand and requires less boilerplate; but, the more components that need a particular piece of state, the more brittle your UI hierarchy becomes. Eventually, it makes sense to move &quot;popular state&quot; into a UI-independent data container, an identity map which other components can read from.</p><p class="mt-4 lg:mt-6">The key insight is that <em>all changing application state should have a single owner</em>, and thus a single source of truth. Further, only the owner should be allowed to mutate that state. If the state lives in the UI hierarchy, the single owner should be the Lowest Common Ancestor of all components that need that state.</p><p class="mt-4 lg:mt-6">To summarize,</p><ol class="pl-6 mt-4 list-decimal lg:mt-6"><li class="mt-2">Start by storing state on local component instances</li><li class="mt-2">Once a piece of application state is needed by more than one component, move that state up to the LCA</li><li class="mt-2">Once there are many components acting as middlemen, or it feels wrong for any particular component to own some state, pull that state out of the UI hierarchy and into a data container (an Ember Service, a Flux store, etc.)</li></ol><p class="mt-4 lg:mt-6">While our example above might seem simple enough, this pattern goes a long way in keeping your application&#x27;s architecture consistent and easy to reason about.</p></article><p class="pt-8 text-sm font-medium text-right text-gray-500 md:mt-1">December 8, 2015</p><hr class="mt-10"/><div class="mt-10"><div><a class="block w-16 h-16 mx-auto overflow-hidden rounded-full" href="/"><div style="max-width:100%;width:985px"><div style="position:relative;padding-bottom:100%"><img data-src="/_next/image?url=%2Fimages%2Fprofile.jpeg&amp;w=1024&amp;q=75" data-srcset="/_next/image?url=%2Fimages%2Fprofile.jpeg&amp;w=320&amp;q=75 320w, /_next/image?url=%2Fimages%2Fprofile.jpeg&amp;w=420&amp;q=75 420w, /_next/image?url=%2Fimages%2Fprofile.jpeg&amp;w=768&amp;q=75 768w, /_next/image?url=%2Fimages%2Fprofile.jpeg&amp;w=1024&amp;q=75 1024w" class="__lazy" style="visibility:hidden;height:100%;left:0;position:absolute;top:0;width:100%"/></div></div></a></div><div class="mt-2 leading-none text-center"><p class="pt-2 text-xs font-semibold tracking-wider text-gray-600 uppercase">Written by</p><p class="pt-2 text-xl font-semibold"><a href="/">Sam Selikoff</a></p></div></div><div class="pb-24 mt-8 text-center"><a class="font-medium text-blue-500" href="/blog">‚Üê View all posts</a></div></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/lowest-common-ancestor","query":{},"buildId":"rc4hxD8C_pz-l0Zida7Fo","assetPrefix":"/new-profile","nextExport":true,"autoExport":true,"isFallback":false,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"charSet":"utf-8"}],["link",{"rel":"apple-touch-icon","sizes":"57x57","href":"/isotype.png"}],["link",{"rel":"apple-touch-icon","sizes":"60x60","href":"/isotype.png"}],["link",{"rel":"apple-touch-icon","sizes":"72x72","href":"/isotype.png"}],["link",{"rel":"apple-touch-icon","sizes":"76x76","href":"/isotype.png"}],["link",{"rel":"apple-touch-icon","sizes":"114x114","href":"/isotype.png"}],["link",{"rel":"apple-touch-icon","sizes":"120x120","href":"/isotype.png"}],["link",{"rel":"apple-touch-icon","sizes":"144x144","href":"/isotype.png"}],["link",{"rel":"apple-touch-icon","sizes":"152x152","href":"/isotype.png"}],["link",{"rel":"apple-touch-icon","sizes":"180x180","href":"/isotype.png"}],["link",{"rel":"icon","type":"image/png","sizes":"192x192","href":"/isotype.png"}],["link",{"rel":"icon","type":"image/png","sizes":"32x32","href":"/isotype.png"}],["link",{"rel":"icon","type":"image/png","sizes":"96x96","href":"/isotype.png"}],["link",{"rel":"icon","type":"image/png","sizes":"16x16","href":"/isotype.png"}],["link",{"rel":"manifest","href":"/manifest.json"}],["meta",{"name":"msapplication-TileColor","content":"#ffffff"}],["meta",{"name":"msapplication-TileImage","content":"/isotype.png"}],["meta",{"name":"theme-color","content":"#ffffff"}],["title",{"children":"Lowest Common Ancestor"}]]}</script><script nomodule="" src="/new-profile/_next/static/chunks/polyfills-f9ac226678fc858257de.js"></script><script src="/new-profile/_next/static/chunks/main-5ab6ea82c9087f336e12.js" async=""></script><script src="/new-profile/_next/static/chunks/webpack-38f4ef47162466e52626.js" async=""></script><script src="/new-profile/_next/static/chunks/framework.7008427c9ed7ea1ea070.js" async=""></script><script src="/new-profile/_next/static/chunks/1ca0266d.bc7564fa166f0d34b14f.js" async=""></script><script src="/new-profile/_next/static/chunks/commons.c903b9c5c3d275f65bfc.js" async=""></script><script src="/new-profile/_next/static/chunks/74dccfed65656dfb6adb258ae839e136f67e0276.47b8922ced02d1ddaa2f.js" async=""></script><script src="/new-profile/_next/static/chunks/2412aec2c30a40454afb28aa7ad51596c664a3e6.1e80e1ab8448746fa0db.js" async=""></script><script src="/new-profile/_next/static/chunks/pages/_app-52d859afcfe46e563952.js" async=""></script><script src="/new-profile/_next/static/chunks/57c9d6e4b97e6bcf244aee8ce3648d5d9adaacb1.bfcec4d669b9affd02e0.js" async=""></script><script src="/new-profile/_next/static/chunks/798fd9b41a459e61ee4594ce38d25c96f259064c.8c8bea5984a65dd9a41b.js" async=""></script><script src="/new-profile/_next/static/chunks/pages/blog/lowest-common-ancestor-7a71ba803a87dfa33e45.js" async=""></script><script src="/new-profile/_next/static/rc4hxD8C_pz-l0Zida7Fo/_buildManifest.js" async=""></script><script src="/new-profile/_next/static/rc4hxD8C_pz-l0Zida7Fo/_ssgManifest.js" async=""></script></body></html>